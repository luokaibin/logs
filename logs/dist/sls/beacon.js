const utf8TextDecoder="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class Pbf{constructor(buf=new Uint8Array(16)){this.buf=ArrayBuffer.isView(buf)?buf:new Uint8Array(buf),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(readField,result,end=this.length){for(;this.pos<end;){const val=this.readVarint(),tag=val>>3,startPos=this.pos;this.type=7&val,readField(tag,result,this),this.pos===startPos&&this.skip(val)}return result}readMessage(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)}readFixed32(){const val=this.dataView.getUint32(this.pos,!0);return this.pos+=4,val}readSFixed32(){const val=this.dataView.getInt32(this.pos,!0);return this.pos+=4,val}readFixed64(){const val=this.dataView.getUint32(this.pos,!0)+4294967296*this.dataView.getUint32(this.pos+4,!0);return this.pos+=8,val}readSFixed64(){const val=this.dataView.getUint32(this.pos,!0)+4294967296*this.dataView.getInt32(this.pos+4,!0);return this.pos+=8,val}readFloat(){const val=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,val}readDouble(){const val=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,val}readVarint(isSigned){const buf=this.buf;let val,b;return b=buf[this.pos++],val=127&b,b<128?val:(b=buf[this.pos++],val|=(127&b)<<7,b<128?val:(b=buf[this.pos++],val|=(127&b)<<14,b<128?val:(b=buf[this.pos++],val|=(127&b)<<21,b<128?val:(b=buf[this.pos],val|=(15&b)<<28,function(l,s,p){const buf=p.buf;let h,b;if(b=buf[p.pos++],h=(112&b)>>4,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<3,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<10,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<17,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<24,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(1&b)<<31,b<128)return toNum(l,h,s);throw new Error("Expected varint not more than 10 bytes")}(val,isSigned,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const num=this.readVarint();return num%2==1?(num+1)/-2:num/2}readBoolean(){return Boolean(this.readVarint())}readString(){const end=this.readVarint()+this.pos,pos=this.pos;return this.pos=end,end-pos>=12&&utf8TextDecoder?utf8TextDecoder.decode(this.buf.subarray(pos,end)):function(buf,pos,end){let str="",i=pos;for(;i<end;){const b0=buf[i];let b1,b2,b3,c=null,bytesPerSequence=b0>239?4:b0>223?3:b0>191?2:1;if(i+bytesPerSequence>end)break;1===bytesPerSequence?b0<128&&(c=b0):2===bytesPerSequence?(b1=buf[i+1],128==(192&b1)&&(c=(31&b0)<<6|63&b1,c<=127&&(c=null))):3===bytesPerSequence?(b1=buf[i+1],b2=buf[i+2],128==(192&b1)&&128==(192&b2)&&(c=(15&b0)<<12|(63&b1)<<6|63&b2,(c<=2047||c>=55296&&c<=57343)&&(c=null))):4===bytesPerSequence&&(b1=buf[i+1],b2=buf[i+2],b3=buf[i+3],128==(192&b1)&&128==(192&b2)&&128==(192&b3)&&(c=(15&b0)<<18|(63&b1)<<12|(63&b2)<<6|63&b3,(c<=65535||c>=1114112)&&(c=null))),null===c?(c=65533,bytesPerSequence=1):c>65535&&(c-=65536,str+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),str+=String.fromCharCode(c),i+=bytesPerSequence}return str}(this.buf,pos,end)}readBytes(){const end=this.readVarint()+this.pos,buffer=this.buf.subarray(this.pos,end);return this.pos=end,buffer}readPackedVarint(arr=[],isSigned){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readVarint(isSigned));return arr}readPackedSVarint(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readSVarint());return arr}readPackedBoolean(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readBoolean());return arr}readPackedFloat(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readFloat());return arr}readPackedDouble(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readDouble());return arr}readPackedFixed32(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readFixed32());return arr}readPackedSFixed32(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readSFixed32());return arr}readPackedFixed64(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readFixed64());return arr}readPackedSFixed64(arr=[]){const end=this.readPackedEnd();for(;this.pos<end;)arr.push(this.readSFixed64());return arr}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(val){const type=7&val;if(0===type)for(;this.buf[this.pos++]>127;);else if(2===type)this.pos=this.readVarint()+this.pos;else if(5===type)this.pos+=4;else{if(1!==type)throw new Error(`Unimplemented type: ${type}`);this.pos+=8}}writeTag(tag,type){this.writeVarint(tag<<3|type)}realloc(min){let length=this.length||16;for(;length<this.pos+min;)length*=2;if(length!==this.length){const buf=new Uint8Array(length);buf.set(this.buf),this.buf=buf,this.dataView=new DataView(buf.buffer),this.length=length}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(val){this.realloc(4),this.dataView.setInt32(this.pos,val,!0),this.pos+=4}writeSFixed32(val){this.realloc(4),this.dataView.setInt32(this.pos,val,!0),this.pos+=4}writeFixed64(val){this.realloc(8),this.dataView.setInt32(this.pos,-1&val,!0),this.dataView.setInt32(this.pos+4,Math.floor(2.3283064365386963e-10*val),!0),this.pos+=8}writeSFixed64(val){this.realloc(8),this.dataView.setInt32(this.pos,-1&val,!0),this.dataView.setInt32(this.pos+4,Math.floor(2.3283064365386963e-10*val),!0),this.pos+=8}writeVarint(val){(val=+val||0)>268435455||val<0?function(val,pbf){let low,high;val>=0?(low=val%4294967296|0,high=val/4294967296|0):(low=~(-val%4294967296),high=~(-val/4294967296),4294967295^low?low=low+1|0:(low=0,high=high+1|0));if(val>=0x10000000000000000||val<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");pbf.realloc(10),function(low,high,pbf){pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos]=127&low}(low,0,pbf),function(high,pbf){const lsb=(7&high)<<4;if(pbf.buf[pbf.pos++]|=lsb|((high>>>=3)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;pbf.buf[pbf.pos++]=127&high}(high,pbf)}(val,this):(this.realloc(4),this.buf[this.pos++]=127&val|(val>127?128:0),val<=127||(this.buf[this.pos++]=127&(val>>>=7)|(val>127?128:0),val<=127||(this.buf[this.pos++]=127&(val>>>=7)|(val>127?128:0),val<=127||(this.buf[this.pos++]=val>>>7&127))))}writeSVarint(val){this.writeVarint(val<0?2*-val-1:2*val)}writeBoolean(val){this.writeVarint(+val)}writeString(str){str=String(str),this.realloc(4*str.length),this.pos++;const startPos=this.pos;this.pos=function(buf,str,pos){for(let c,lead,i=0;i<str.length;i++){if(c=str.charCodeAt(i),c>55295&&c<57344){if(!lead){c>56319||i+1===str.length?(buf[pos++]=239,buf[pos++]=191,buf[pos++]=189):lead=c;continue}if(c<56320){buf[pos++]=239,buf[pos++]=191,buf[pos++]=189,lead=c;continue}c=lead-55296<<10|c-56320|65536,lead=null}else lead&&(buf[pos++]=239,buf[pos++]=191,buf[pos++]=189,lead=null);c<128?buf[pos++]=c:(c<2048?buf[pos++]=c>>6|192:(c<65536?buf[pos++]=c>>12|224:(buf[pos++]=c>>18|240,buf[pos++]=c>>12&63|128),buf[pos++]=c>>6&63|128),buf[pos++]=63&c|128)}return pos}(this.buf,str,this.pos);const len=this.pos-startPos;len>=128&&makeRoomForExtraLength(startPos,len,this),this.pos=startPos-1,this.writeVarint(len),this.pos+=len}writeFloat(val){this.realloc(4),this.dataView.setFloat32(this.pos,val,!0),this.pos+=4}writeDouble(val){this.realloc(8),this.dataView.setFloat64(this.pos,val,!0),this.pos+=8}writeBytes(buffer){const len=buffer.length;this.writeVarint(len),this.realloc(len);for(let i=0;i<len;i++)this.buf[this.pos++]=buffer[i]}writeRawMessage(fn,obj){this.pos++;const startPos=this.pos;fn(obj,this);const len=this.pos-startPos;len>=128&&makeRoomForExtraLength(startPos,len,this),this.pos=startPos-1,this.writeVarint(len),this.pos+=len}writeMessage(tag,fn,obj){this.writeTag(tag,2),this.writeRawMessage(fn,obj)}writePackedVarint(tag,arr){arr.length&&this.writeMessage(tag,writePackedVarint,arr)}writePackedSVarint(tag,arr){arr.length&&this.writeMessage(tag,writePackedSVarint,arr)}writePackedBoolean(tag,arr){arr.length&&this.writeMessage(tag,writePackedBoolean,arr)}writePackedFloat(tag,arr){arr.length&&this.writeMessage(tag,writePackedFloat,arr)}writePackedDouble(tag,arr){arr.length&&this.writeMessage(tag,writePackedDouble,arr)}writePackedFixed32(tag,arr){arr.length&&this.writeMessage(tag,writePackedFixed32,arr)}writePackedSFixed32(tag,arr){arr.length&&this.writeMessage(tag,writePackedSFixed32,arr)}writePackedFixed64(tag,arr){arr.length&&this.writeMessage(tag,writePackedFixed64,arr)}writePackedSFixed64(tag,arr){arr.length&&this.writeMessage(tag,writePackedSFixed64,arr)}writeBytesField(tag,buffer){this.writeTag(tag,2),this.writeBytes(buffer)}writeFixed32Field(tag,val){this.writeTag(tag,5),this.writeFixed32(val)}writeSFixed32Field(tag,val){this.writeTag(tag,5),this.writeSFixed32(val)}writeFixed64Field(tag,val){this.writeTag(tag,1),this.writeFixed64(val)}writeSFixed64Field(tag,val){this.writeTag(tag,1),this.writeSFixed64(val)}writeVarintField(tag,val){this.writeTag(tag,0),this.writeVarint(val)}writeSVarintField(tag,val){this.writeTag(tag,0),this.writeSVarint(val)}writeStringField(tag,str){this.writeTag(tag,2),this.writeString(str)}writeFloatField(tag,val){this.writeTag(tag,5),this.writeFloat(val)}writeDoubleField(tag,val){this.writeTag(tag,1),this.writeDouble(val)}writeBooleanField(tag,val){this.writeVarintField(tag,+val)}}function toNum(low,high,isSigned){return isSigned?4294967296*high+(low>>>0):4294967296*(high>>>0)+(low>>>0)}function makeRoomForExtraLength(startPos,len,pbf){const extraLen=len<=16383?1:len<=2097151?2:len<=268435455?3:Math.floor(Math.log(len)/(7*Math.LN2));pbf.realloc(extraLen);for(let i=pbf.pos-1;i>=startPos;i--)pbf.buf[i+extraLen]=pbf.buf[i]}function writePackedVarint(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(let i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}function writeLog(obj,pbf){if(obj.Time&&pbf.writeVarintField(1,obj.Time),obj.Contents)for(const item of obj.Contents)pbf.writeMessage(2,writeLogContent,item);obj.TimeNs&&pbf.writeFixed32Field(4,obj.TimeNs)}function writeLogContent(obj,pbf){obj.Key&&pbf.writeStringField(1,obj.Key),obj.Value&&pbf.writeStringField(2,obj.Value)}function writeLogTag(obj,pbf){obj.Key&&pbf.writeStringField(1,obj.Key),obj.Value&&pbf.writeStringField(2,obj.Value)}async function logEncoder(logs){if(!Array.isArray(logs))throw new Error("logs must be array!");const packId=await(this?._generateLogContext?.()),pack=packId?{key:"__pack_id__",value:packId}:void 0,payload={Logs:logs.map((log=>{const{time:time,...rest}=log;return{Time:Math.floor(time/1e3),Contents:Object.entries(rest).reduce(((acc,[Key,Value])=>{if(!Key||null==Value)return acc;const finalValue="string"==typeof Value?Value:JSON.stringify(Value);return finalValue.trim()?(acc.push({Key:Key,Value:finalValue}),acc):acc}),[])}})).filter((item=>!!item?.Contents?.length&&!!item?.Time)),LogTags:[pack]};if(!payload.Logs?.length)return;const pbf=new Pbf;return function(obj,pbf){if(obj.Logs)for(const item of obj.Logs)pbf.writeMessage(1,writeLog,item);if(obj.Reserved&&pbf.writeStringField(2,obj.Reserved),obj.Topic&&pbf.writeStringField(3,obj.Topic),obj.Source&&pbf.writeStringField(4,obj.Source),obj.LogTags)for(const item of obj.LogTags)pbf.writeMessage(6,writeLogTag,item)}(payload,pbf),pbf.finish()}const ARRAY_SAMPLING_CONFIG={primitive:{threshold:20,head:10,tail:4,middle:3},complex:{threshold:10,head:5,tail:3,middle:2}};function serializeLogContent(content){const serializableObject=serializeSingleValue(content);try{const result=JSON.stringify(serializableObject);return result.length>1e5?result.slice(0,1e5)+"...":result}catch(e){return`[序列化失败: ${e.message}]`}}function serializeSingleValue(value,options={maxDepth:10,sensitiveKeys:["password","token","secret","auth"]},currentDepth=0,seen=new WeakSet){const{maxDepth:maxDepth,sensitiveKeys:sensitiveKeys}=options,type=typeof value;if(null===value||["string","number","boolean","undefined"].includes(type))return value;if("bigint"===type)return`${value.toString()}n`;if("symbol"===type)return value.toString();if("function"===type)return`[Function: ${value.name||"anonymous"}]`;if("object"==typeof value){if(seen.has(value))return"[循环引用]";seen.add(value)}if(currentDepth>=maxDepth)return`[达到最大深度: ${Object.prototype.toString.call(value)}]`;if(value instanceof Error)return`${value.name}: ${value.message}\nStack: ${value.stack||""}`;if(value instanceof Date)return value.toISOString();if(value instanceof RegExp)return value.toString();if("undefined"!=typeof Map&&value instanceof Map){const obj={};for(const[k,v]of value.entries()){obj["object"==typeof k&&null!==k?"[object]":String(k)]=serializeSingleValue(v,options,currentDepth+1,seen)}return obj}if("undefined"!=typeof Set&&value instanceof Set){const arr=[];for(const v of value.values())arr.push(serializeSingleValue(v,options,currentDepth+1,seen));return arr}if(Array.isArray(value)){const rules=value.length>0&&"object"==typeof value[0]&&null!==value[0]?ARRAY_SAMPLING_CONFIG.complex:ARRAY_SAMPLING_CONFIG.primitive;if(value.length<=rules.threshold)return value.map((item=>serializeSingleValue(item,options,currentDepth+1,seen)));const sampledResult={_t:"arr",_l:value.length,_e:{}},indices=new Set;for(let i=0;i<rules.head&&i<value.length;i++)indices.add(i);for(let i=0;i<rules.tail&&value.length-1-i>=0;i++)indices.add(value.length-1-i);const midStart=Math.floor(value.length/2-rules.middle/2);for(let i=0;i<rules.middle&&midStart+i<value.length;i++)indices.add(midStart+i);const sortedIndices=Array.from(indices).sort(((a,b)=>a-b));for(const index of sortedIndices)sampledResult._e[index]=serializeSingleValue(value[index],options,currentDepth+1,seen);return sampledResult}if("undefined"!=typeof window&&value instanceof window.Element)return`<${value.tagName.toLowerCase()} class="${value.className}" id="${value.id}">`;if("object"==typeof value&&null!==value){if("function"==typeof value.toJSON)return serializeSingleValue(value.toJSON(),options,currentDepth+1,seen);const result={};for(const key of Object.keys(value))sensitiveKeys.includes(key.toLowerCase())?result[key]="[敏感信息已过滤]":result[key]=serializeSingleValue(value[key],options,currentDepth+1,seen);return result}return String(value)}function getOrCreateUUID(){if("undefined"==typeof window)return"";const key="_client_uuid";let uuid=window.localStorage.getItem(key);return uuid||(window.crypto&&window.crypto.randomUUID?(uuid=window.crypto.randomUUID(),window.localStorage.setItem(key,uuid)):(uuid=Math.random().toString(36).substring(2)+Date.now().toString(36),window.localStorage.setItem(key,uuid))),uuid}function getLogExtraInfo(){if("undefined"==typeof window||void 0===window.document)return{};return{time:Date.now(),clientUuid:getOrCreateUUID(),userAgent:window.navigator.userAgent,screen:JSON.stringify(serializeSingleValue({width:window.screen.width,height:window.screen.height})),window:JSON.stringify(serializeSingleValue({width:window.innerWidth,height:window.innerHeight})),url:window.location.href,referrer:document.referrer}}async function getServiceWorker(scope="/beacon/"){if(!navigator.serviceWorker)return null;try{const swRegistration=(await navigator.serviceWorker.getRegistrations()).find((reg=>reg.scope.includes(scope)));if(!swRegistration)return null;if(swRegistration.active)return swRegistration.active;if(swRegistration.installing&&swRegistration.waiting)return null;const worker=swRegistration.installing||swRegistration.waiting;if(!worker)return null;const waitForActivation=new Promise(((resolve,reject)=>{worker.addEventListener("statechange",(function(){"activated"===this.state?resolve(swRegistration.active):"redundant"===this.state&&reject(new Error("Service Worker installation failed"))}))})),timeout=new Promise(((_,reject)=>{setTimeout((()=>reject(new Error("Service Worker activation timeout"))),6e4)}));return await Promise.race([waitForActivation,timeout])}catch(e){return null}}async function sendEvent(msg){try{const serviceWorker=await getServiceWorker("/beacon/");if(serviceWorker)serviceWorker.postMessage(msg);else{const event=new CustomEvent("sendLog",{detail:msg});window.dispatchEvent(event)}}catch(e){}}async function sendLog(level,logs){if("undefined"==typeof window)return;const extraInfo=getLogExtraInfo();sendEvent({type:"log",payload:{level:level,content:serializeLogContent(logs),...extraInfo}})}const instanceOfAny=(object,constructors)=>constructors.some((c=>object instanceof c));let idbProxyableTypes,cursorAdvanceMethods;const transactionDoneMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;let idbProxyTraps={get(target,prop,receiver){if(target instanceof IDBTransaction){if("done"===prop)return transactionDoneMap.get(target);if("store"===prop)return receiver.objectStoreNames[1]?void 0:receiver.objectStore(receiver.objectStoreNames[0])}return wrap(target[prop])},set:(target,prop,value)=>(target[prop]=value,!0),has:(target,prop)=>target instanceof IDBTransaction&&("done"===prop||"store"===prop)||prop in target};function replaceTraps(callback){idbProxyTraps=callback(idbProxyTraps)}function wrapFunction(func){return(cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(func)?function(...args){return func.apply(unwrap(this),args),wrap(this.request)}:function(...args){return wrap(func.apply(unwrap(this),args))}}function transformCachableValue(value){return"function"==typeof value?wrapFunction(value):(value instanceof IDBTransaction&&function(tx){if(transactionDoneMap.has(tx))return;const done=new Promise(((resolve,reject)=>{const unlisten=()=>{tx.removeEventListener("complete",complete),tx.removeEventListener("error",error),tx.removeEventListener("abort",error)},complete=()=>{resolve(),unlisten()},error=()=>{reject(tx.error||new DOMException("AbortError","AbortError")),unlisten()};tx.addEventListener("complete",complete),tx.addEventListener("error",error),tx.addEventListener("abort",error)}));transactionDoneMap.set(tx,done)}(value),instanceOfAny(value,idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(value,idbProxyTraps):value)}function wrap(value){if(value instanceof IDBRequest)return function(request){const promise=new Promise(((resolve,reject)=>{const unlisten=()=>{request.removeEventListener("success",success),request.removeEventListener("error",error)},success=()=>{resolve(wrap(request.result)),unlisten()},error=()=>{reject(request.error),unlisten()};request.addEventListener("success",success),request.addEventListener("error",error)}));return reverseTransformCache.set(promise,request),promise}(value);if(transformCache.has(value))return transformCache.get(value);const newValue=transformCachableValue(value);return newValue!==value&&(transformCache.set(value,newValue),reverseTransformCache.set(newValue,value)),newValue}const unwrap=value=>reverseTransformCache.get(value);const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(target,prop){if(!(target instanceof IDBDatabase)||prop in target||"string"!=typeof prop)return;if(cachedMethods.get(prop))return cachedMethods.get(prop);const targetFuncName=prop.replace(/FromIndex$/,""),useIndex=prop!==targetFuncName,isWrite=writeMethods.includes(targetFuncName);if(!(targetFuncName in(useIndex?IDBIndex:IDBObjectStore).prototype)||!isWrite&&!readMethods.includes(targetFuncName))return;const method=async function(storeName,...args){const tx=this.transaction(storeName,isWrite?"readwrite":"readonly");let target=tx.store;return useIndex&&(target=target.index(args.shift())),(await Promise.all([target[targetFuncName](...args),isWrite&&tx.done]))[0]};return cachedMethods.set(prop,method),method}replaceTraps((oldTraps=>({...oldTraps,get:(target,prop,receiver)=>getMethod(target,prop)||oldTraps.get(target,prop,receiver),has:(target,prop)=>!!getMethod(target,prop)||oldTraps.has(target,prop)})));const advanceMethodProps=["continue","continuePrimaryKey","advance"],methodMap={},advanceResults=new WeakMap,ittrProxiedCursorToOriginalProxy=new WeakMap,cursorIteratorTraps={get(target,prop){if(!advanceMethodProps.includes(prop))return target[prop];let cachedFunc=methodMap[prop];return cachedFunc||(cachedFunc=methodMap[prop]=function(...args){advanceResults.set(this,ittrProxiedCursorToOriginalProxy.get(this)[prop](...args))}),cachedFunc}};async function*iterate(...args){let cursor=this;if(cursor instanceof IDBCursor||(cursor=await cursor.openCursor(...args)),!cursor)return;const proxiedCursor=new Proxy(cursor,cursorIteratorTraps);for(ittrProxiedCursorToOriginalProxy.set(proxiedCursor,cursor),reverseTransformCache.set(proxiedCursor,unwrap(cursor));cursor;)yield proxiedCursor,cursor=await(advanceResults.get(proxiedCursor)||cursor.continue()),advanceResults.delete(proxiedCursor)}function isIteratorProp(target,prop){return prop===Symbol.asyncIterator&&instanceOfAny(target,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===prop&&instanceOfAny(target,[IDBIndex,IDBObjectStore])}replaceTraps((oldTraps=>({...oldTraps,get:(target,prop,receiver)=>isIteratorProp(target,prop)?iterate:oldTraps.get(target,prop,receiver),has:(target,prop)=>isIteratorProp(target,prop)||oldTraps.has(target,prop)})));class LogStore{_dbPromise=null;constructor(){this._initDB()}_initDB(){this._dbPromise=function(name,version,{blocked:blocked,upgrade:upgrade,blocking:blocking,terminated:terminated}={}){const request=indexedDB.open(name,version),openPromise=wrap(request);return upgrade&&request.addEventListener("upgradeneeded",(event=>{upgrade(wrap(request.result),event.oldVersion,event.newVersion,wrap(request.transaction),event)})),blocked&&request.addEventListener("blocked",(event=>blocked(event.oldVersion,event.newVersion,event))),openPromise.then((db=>{terminated&&db.addEventListener("close",(()=>terminated())),blocking&&db.addEventListener("versionchange",(event=>blocking(event.oldVersion,event.newVersion,event)))})).catch((()=>{})),openPromise}("beacon-db",1,{upgrade(db){if(db.objectStoreNames.contains("b_dat")||db.createObjectStore("b_dat",{keyPath:"id",autoIncrement:!0}),!db.objectStoreNames.contains("digestCache")){db.createObjectStore("digestCache",{keyPath:"digest"}).createIndex("by_timestamp","timestamp")}db.objectStoreNames.contains("meta")||db.createObjectStore("meta")}})}async _getDB(){return this._dbPromise||this._initDB(),this._dbPromise}_encode(data){return(new TextEncoder).encode(data)}_decode(buffer){return buffer?(new TextDecoder).decode(buffer):null}async insertLog(logData){return(await this._getDB()).add("b_dat",logData)}async getAllLogs(){return(await this._getDB()).getAll("b_dat")}async clearLogs(){const db=await this._getDB();await db.clear("b_dat")}async setDigest(digest,timestamp){return(await this._getDB()).put("digestCache",{digest:digest,timestamp:timestamp})}async getAllDigests(){return(await this._getDB()).getAll("digestCache")}async clearOldDigests(maxAgeTimestamp){const tx=(await this._getDB()).transaction("digestCache","readwrite"),index=tx.store.index("by_timestamp");let cursor=await index.openCursor(IDBKeyRange.upperBound(maxAgeTimestamp));for(;cursor;)await cursor.delete(),cursor=await cursor.continue();await tx.done}async setMeta(key,value){const db=await this._getDB(),encodedValue=this._encode(value);return db.put("meta",encodedValue,key)}async getMeta(key){const db=await this._getDB(),encodedValue=await db.get("meta",key);return this._decode(encodedValue)}async getAllMeta(){const tx=(await this._getDB()).transaction("meta","readonly"),store=tx.store,allMeta={};let cursor=await store.openCursor();for(;cursor;)allMeta[cursor.key]=this._decode(cursor.value),cursor=await cursor.continue();return await tx.done,allMeta}async hydrateState(){const[logs,digests,deviceInfo,logContext]=await Promise.all([this.getAllLogs(),this.getAllDigests(),this.getMeta("deviceInfo"),this.getMeta("logContext")]);return{logs:logs,digests:digests,deviceInfo:deviceInfo,logContext:logContext}}}var props,NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",MODEL="model",MOBILE="mobile",TABLET="tablet",SMARTTV="smarttv",CH_ALL_VALUES=["brands","fullVersionList",MOBILE,MODEL,"platform","platformVersion","architecture","formFactors","bitness"],NAVIGATOR="undefined"!=typeof window&&window.navigator?window.navigator:void 0,NAVIGATOR_UADATA=NAVIGATOR&&NAVIGATOR.userAgentData?NAVIGATOR.userAgentData:void 0,enumerize=function(arr){for(var enums={},i=0;i<arr.length;i++)enums[arr[i].toUpperCase()]=arr[i];return enums},has=function(str1,str2){if("object"==typeof str1&&str1.length>0){for(var i in str1)if(lowerize(str1[i])==lowerize(str2))return!0;return!1}return!!isString(str1)&&-1!==lowerize(str2).indexOf(lowerize(str1))},isExtensions=function(obj,deep){for(var prop in obj)return/^(browser|cpu|device|engine|os)$/.test(prop)||!!deep&&isExtensions(obj[prop])},isString=function(val){return"string"==typeof val},itemListToArray=function(header){if(header){for(var arr=[],tokens=strip(/\\?\"/g,header).split(","),i=0;i<tokens.length;i++)if(tokens[i].indexOf(";")>-1){var token=trim(tokens[i]).split(";v=");arr[i]={brand:token[0],version:token[1]}}else arr[i]=trim(tokens[i]);return arr}},lowerize=function(str){return isString(str)?str.toLowerCase():str},majorize=function(version){return isString(version)?strip(/[^\d\.]/g,version).split(".")[0]:void 0},setProps=function(arr){for(var i in arr){var propName=arr[i];"object"==typeof propName&&2==propName.length?this[propName[0]]=propName[1]:this[propName]=void 0}return this},strip=function(pattern,str){return isString(str)?str.replace(pattern,""):str},stripQuotes=function(str){return strip(/\\?\"/g,str)},trim=function(str,len){if(isString(str))return str=strip(/^\s\s*/,str),void 0===len?str:str.substring(0,500)},rgxMapper=function(ua,arrays){if(ua&&arrays)for(var j,k,p,q,matches,match,i=0;i<arrays.length&&!matches;){var regex=arrays[i],props=arrays[i+1];for(j=k=0;j<regex.length&&!matches&&regex[j];)if(matches=regex[j++].exec(ua))for(p=0;p<props.length;p++)match=matches[++k],"object"==typeof(q=props[p])&&q.length>0?2===q.length?"function"==typeof q[1]?this[q[0]]=q[1].call(this,match):this[q[0]]=q[1]:3===q.length?"function"!=typeof q[1]||q[1].exec&&q[1].test?this[q[0]]=match?match.replace(q[1],q[2]):void 0:this[q[0]]=match?q[1].call(this,match,q[2]):void 0:4===q.length&&(this[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):void 0):this[q]=match||void 0;i+=2}},strMapper=function(str,map){for(var i in map)if("object"==typeof map[i]&&map[i].length>0){for(var j=0;j<map[i].length;j++)if(has(map[i][j],str))return"?"===i?void 0:i}else if(has(map[i],str))return"?"===i?void 0:i;return map.hasOwnProperty("*")?map["*"]:str},windowsVersionMap={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},formFactorsMap={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":void 0},defaultRegexes={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[VERSION,[NAME,"Mobile Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[VERSION,[NAME,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[NAME,VERSION],[/opios[\/ ]+([\w\.]+)/i],[VERSION,[NAME,"Opera Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[VERSION,[NAME,"Opera GX"]],[/\bopr\/([\w\.]+)/i],[VERSION,[NAME,"Opera"]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[VERSION,[NAME,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[VERSION,[NAME,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[NAME,VERSION],[/quark(?:pc)?\/([-\w\.]+)/i],[VERSION,[NAME,"Quark"]],[/\bddg\/([\w\.]+)/i],[VERSION,[NAME,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[VERSION,[NAME,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[VERSION,[NAME,"WeChat"]],[/konqueror\/([\w\.]+)/i],[VERSION,[NAME,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[VERSION,[NAME,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[VERSION,[NAME,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[VERSION,[NAME,"Smart Lenovo Browser"]],[/(avast|avg)\/([\w\.]+)/i],[[NAME,/(.+)/,"$1 Secure Browser"],VERSION],[/\bfocus\/([\w\.]+)/i],[VERSION,[NAME,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[VERSION,[NAME,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[VERSION,[NAME,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[VERSION,[NAME,"Dolphin"]],[/coast\/([\w\.]+)/i],[VERSION,[NAME,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[VERSION,[NAME,"MIUI Browser"]],[/fxios\/([\w\.-]+)/i],[VERSION,[NAME,"Mobile Firefox"]],[/\bqihoobrowser\/?([\w\.]*)/i],[VERSION,[NAME,"360"]],[/\b(qq)\/([\w\.]+)/i],[[NAME,/(.+)/,"$1Browser"],VERSION],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[NAME,/(.+)/,"$1 Browser"],VERSION],[/samsungbrowser\/([\w\.]+)/i],[VERSION,[NAME,"Samsung Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[VERSION,[NAME,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[NAME,"Sogou Mobile"],VERSION],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[NAME,VERSION],[/(lbbrowser|rekonq)/i],[NAME],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[VERSION,NAME],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[NAME,"Facebook"],VERSION,[TYPE,"inapp"]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[NAME,VERSION,[TYPE,"inapp"]],[/\bgsa\/([\w\.]+) .*safari\//i],[VERSION,[NAME,"GSA"],[TYPE,"inapp"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[VERSION,[NAME,"TikTok"],[TYPE,"inapp"]],[/\[(linkedin)app\]/i],[NAME,[TYPE,"inapp"]],[/(chromium)[\/ ]([-\w\.]+)/i],[NAME,VERSION],[/headlesschrome(?:\/([\w\.]+)| )/i],[VERSION,[NAME,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[NAME,"Chrome WebView"],VERSION],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[VERSION,[NAME,"Android Browser"]],[/chrome\/([\w\.]+) mobile/i],[VERSION,[NAME,"Mobile Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[NAME,VERSION],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[VERSION,[NAME,"Mobile Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[NAME,"Mobile Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[VERSION,NAME],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[NAME,"Mobile Firefox"],VERSION],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[NAME,"Netscape"],VERSION],[/(wolvic|librewolf)\/([\w\.]+)/i],[NAME,VERSION],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[VERSION,[NAME,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[NAME,[VERSION,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[NAME,[VERSION,/[^\d\.]+./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[["architecture","amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[["architecture","arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[["architecture",/ower/,"",lowerize]],[/ sun4\w[;\)]/i],[["architecture","sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[["architecture",lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[MODEL,[VENDOR,"Samsung"],[TYPE,TABLET]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[MODEL,[VENDOR,"Samsung"],[TYPE,MOBILE]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[MODEL,[VENDOR,"Apple"],[TYPE,MOBILE]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[MODEL,[VENDOR,"Apple"],[TYPE,TABLET]],[/(macintosh);/i],[MODEL,[VENDOR,"Apple"]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[MODEL,[VENDOR,"Sharp"],[TYPE,MOBILE]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[MODEL,[VENDOR,"Honor"],[TYPE,TABLET]],[/honor([-\w ]+)[;\)]/i],[MODEL,[VENDOR,"Honor"],[TYPE,MOBILE]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[MODEL,[VENDOR,"Huawei"],[TYPE,TABLET]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[MODEL,[VENDOR,"Huawei"],[TYPE,MOBILE]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[MODEL,/_/g," "],[VENDOR,"Xiaomi"],[TYPE,TABLET]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[MODEL,/_/g," "],[VENDOR,"Xiaomi"],[TYPE,MOBILE]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[MODEL,[VENDOR,"OPPO"],[TYPE,MOBILE]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[MODEL,[VENDOR,strMapper,{OnePlus:["304","403","203"],"*":"OPPO"}],[TYPE,TABLET]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[MODEL,[VENDOR,"BLU"],[TYPE,MOBILE]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[MODEL,[VENDOR,"Vivo"],[TYPE,MOBILE]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[MODEL,[VENDOR,"Realme"],[TYPE,MOBILE]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[MODEL,[VENDOR,"Motorola"],[TYPE,MOBILE]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,TABLET]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[MODEL,[VENDOR,"LG"],[TYPE,TABLET]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[MODEL,[VENDOR,"LG"],[TYPE,MOBILE]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[MODEL,[VENDOR,"Lenovo"],[TYPE,TABLET]],[/(nokia) (t[12][01])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[MODEL,/_/g," "],[TYPE,MOBILE],[VENDOR,"Nokia"]],[/(pixel (c|tablet))\b/i],[MODEL,[VENDOR,"Google"],[TYPE,TABLET]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[MODEL,[VENDOR,"Google"],[TYPE,MOBILE]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[MODEL,[VENDOR,"Sony"],[TYPE,MOBILE]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[MODEL,"Xperia Tablet"],[VENDOR,"Sony"],[TYPE,TABLET]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[MODEL,[VENDOR,"OnePlus"],[TYPE,MOBILE]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[MODEL,[VENDOR,"Amazon"],[TYPE,TABLET]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[MODEL,/(.+)/g,"Fire Phone $1"],[VENDOR,"Amazon"],[TYPE,MOBILE]],[/(playbook);[-\w\),; ]+(rim)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[MODEL,[VENDOR,"BlackBerry"],[TYPE,MOBILE]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[MODEL,[VENDOR,"ASUS"],[TYPE,TABLET]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[MODEL,[VENDOR,"ASUS"],[TYPE,MOBILE]],[/(nexus 9)/i],[MODEL,[VENDOR,"HTC"],[TYPE,TABLET]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[MODEL,[VENDOR,"TCL"],[TYPE,TABLET]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[MODEL,[VENDOR,"TCL"],[TYPE,MOBILE]],[/(itel) ((\w+))/i],[[VENDOR,lowerize],MODEL,[TYPE,strMapper,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[MODEL,[VENDOR,"Acer"],[TYPE,TABLET]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[MODEL,[VENDOR,"Meizu"],[TYPE,MOBILE]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[MODEL,[VENDOR,"Ulefone"],[TYPE,MOBILE]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[MODEL,[VENDOR,"Energizer"],[TYPE,MOBILE]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[MODEL,[VENDOR,"Cat"],[TYPE,MOBILE]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[MODEL,[VENDOR,"Smartfren"],[TYPE,MOBILE]],[/droid.+; (a(?:015|06[35]|142p?))/i],[MODEL,[VENDOR,"Nothing"],[TYPE,MOBILE]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[MODEL,[VENDOR,"Archos"],[TYPE,TABLET]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[MODEL,[VENDOR,"Archos"],[TYPE,MOBILE]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(surface duo)/i],[MODEL,[VENDOR,"Microsoft"],[TYPE,TABLET]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[MODEL,[VENDOR,"Fairphone"],[TYPE,MOBILE]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,TABLET]],[/(sprint) (\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g," "],[VENDOR,"Microsoft"],[TYPE,MOBILE]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[MODEL,[VENDOR,"Zebra"],[TYPE,TABLET]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[MODEL,[VENDOR,"Zebra"],[TYPE,MOBILE]],[/smart-tv.+(samsung)/i],[VENDOR,[TYPE,SMARTTV]],[/hbbtv.+maple;(\d+)/i],[[MODEL,/^/,"SmartTV"],[VENDOR,"Samsung"],[TYPE,SMARTTV]],[/tcast.+(lg)e?. ([-\w]+)/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[VENDOR,"LG"],[TYPE,SMARTTV]],[/(apple) ?tv/i],[VENDOR,[MODEL,"Apple TV"],[TYPE,SMARTTV]],[/crkey.*devicetype\/chromecast/i],[[MODEL,"Chromecast Third Generation"],[VENDOR,"Google"],[TYPE,SMARTTV]],[/crkey.*devicetype\/([^/]*)/i],[[MODEL,/^/,"Chromecast "],[VENDOR,"Google"],[TYPE,SMARTTV]],[/fuchsia.*crkey/i],[[MODEL,"Chromecast Nest Hub"],[VENDOR,"Google"],[TYPE,SMARTTV]],[/crkey/i],[[MODEL,"Chromecast"],[VENDOR,"Google"],[TYPE,SMARTTV]],[/(portaltv)/i],[MODEL,[VENDOR,"Facebook"],[TYPE,SMARTTV]],[/droid.+aft(\w+)( bui|\))/i],[MODEL,[VENDOR,"Amazon"],[TYPE,SMARTTV]],[/(shield \w+ tv)/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,SMARTTV]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[MODEL,[VENDOR,"Sharp"],[TYPE,SMARTTV]],[/(bravia[\w ]+)( bui|\))/i],[MODEL,[VENDOR,"Sony"],[TYPE,SMARTTV]],[/(mi(tv|box)-?\w+) bui/i],[MODEL,[VENDOR,"Xiaomi"],[TYPE,SMARTTV]],[/Hbbtv.*(technisat) (.*);/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[VENDOR,trim],[MODEL,trim],[TYPE,SMARTTV]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[MODEL,[TYPE,SMARTTV]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[TYPE,SMARTTV]],[/(ouya)/i,/(nintendo) (\w+)/i],[VENDOR,MODEL,[TYPE,"console"]],[/droid.+; (shield)( bui|\))/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,"console"]],[/(playstation \w+)/i],[MODEL,[VENDOR,"Sony"],[TYPE,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[MODEL,[VENDOR,"Microsoft"],[TYPE,"console"]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[MODEL,[VENDOR,"Samsung"],[TYPE,"wearable"]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[VENDOR,MODEL,[TYPE,"wearable"]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[MODEL,[VENDOR,"OPPO"],[TYPE,"wearable"]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[MODEL,[VENDOR,"Apple"],[TYPE,"wearable"]],[/(opwwe\d{3})/i],[MODEL,[VENDOR,"OnePlus"],[TYPE,"wearable"]],[/(moto 360)/i],[MODEL,[VENDOR,"Motorola"],[TYPE,"wearable"]],[/(smartwatch 3)/i],[MODEL,[VENDOR,"Sony"],[TYPE,"wearable"]],[/(g watch r)/i],[MODEL,[VENDOR,"LG"],[TYPE,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[MODEL,[VENDOR,"Zebra"],[TYPE,"wearable"]],[/droid.+; (glass) \d/i],[MODEL,[VENDOR,"Google"],[TYPE,"xr"]],[/(pico) (4|neo3(?: link|pro)?)/i],[VENDOR,MODEL,[TYPE,"xr"]],[/(quest( \d| pro)?s?).+vr/i],[MODEL,[VENDOR,"Facebook"],[TYPE,"xr"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[VENDOR,[TYPE,"embedded"]],[/(aeobc)\b/i],[MODEL,[VENDOR,"Amazon"],[TYPE,"embedded"]],[/(homepod).+mac os/i],[MODEL,[VENDOR,"Apple"],[TYPE,"embedded"]],[/windows iot/i],[[TYPE,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[MODEL,[TYPE,strMapper,{mobile:"Mobile",xr:"VR","*":TABLET}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[TYPE,TABLET]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[TYPE,MOBILE]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[MODEL,[VENDOR,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[VERSION,[NAME,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[NAME,VERSION],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[VERSION,[NAME,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[NAME,VERSION],[/ladybird\//i],[[NAME,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[VERSION,NAME]],os:[[/microsoft (windows) (vista|xp)/i],[NAME,VERSION],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[NAME,[VERSION,strMapper,windowsVersionMap]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[VERSION,strMapper,windowsVersionMap],[NAME,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[VERSION,/_/g,"."],[NAME,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[NAME,"macOS"],[VERSION,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[VERSION,[NAME,"Chromecast Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[VERSION,[NAME,"Chromecast Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[VERSION,[NAME,"Chromecast SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[VERSION,[NAME,"Chromecast Linux"]],[/crkey\/([\d\.]+)/i],[VERSION,[NAME,"Chromecast"]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[VERSION,NAME],[/(ubuntu) ([\w\.]+) like android/i],[[NAME,/(.+)/,"$1 Touch"],VERSION],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[NAME,VERSION],[/\(bb(10);/i],[VERSION,[NAME,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[VERSION,[NAME,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[VERSION,[NAME,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[VERSION,[NAME,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[VERSION,[NAME,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[NAME,"Chrome OS"],VERSION],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[NAME,VERSION],[/(sunos) ?([\w\.\d]*)/i],[[NAME,"Solaris"],VERSION],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[NAME,VERSION]]},defaultProps=(setProps.call((props={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}}).init,[["browser",[NAME,VERSION,"major",TYPE]],["cpu",["architecture"]],["device",[TYPE,MODEL,VENDOR]],["engine",[NAME,VERSION]],["os",[NAME,VERSION]]]),setProps.call(props.isIgnore,[["browser",[VERSION,"major"]],["engine",[VERSION]],["os",[VERSION]]]),setProps.call(props.isIgnoreRgx,[["browser",/ ?browser$/i],["os",/ ?os$/i]]),setProps.call(props.toString,[["browser",[NAME,VERSION]],["cpu",["architecture"]],["device",[VENDOR,MODEL]],["engine",[NAME,VERSION]],["os",[NAME,VERSION]]]),props),createIData=function(item,itemType){var init_props=defaultProps.init[itemType],is_ignoreProps=defaultProps.isIgnore[itemType]||0,is_ignoreRgx=defaultProps.isIgnoreRgx[itemType]||0,toString_props=defaultProps.toString[itemType]||0;function IData(){setProps.call(this,init_props)}return IData.prototype.getItem=function(){return item},IData.prototype.withClientHints=function(){return NAVIGATOR_UADATA?NAVIGATOR_UADATA.getHighEntropyValues(CH_ALL_VALUES).then((function(res){return item.setCH(new UACHData(res,!1)).parseCH().get()})):item.parseCH().get()},IData.prototype.withFeatureCheck=function(){return item.detectFeature().get()},"result"!=itemType&&(IData.prototype.is=function(strToCheck){var is=!1;for(var i in this)if(this.hasOwnProperty(i)&&!has(is_ignoreProps,i)&&lowerize(is_ignoreRgx?strip(is_ignoreRgx,this[i]):this[i])==lowerize(is_ignoreRgx?strip(is_ignoreRgx,strToCheck):strToCheck)){if(is=!0,"undefined"!=strToCheck)break}else if("undefined"==strToCheck&&is){is=!is;break}return is},IData.prototype.toString=function(){var str="";for(var i in toString_props)void 0!==this[toString_props[i]]&&(str+=(str?" ":"")+this[toString_props[i]]);return str||"undefined"}),NAVIGATOR_UADATA||(IData.prototype.then=function(cb){var that=this,IDataResolve=function(){for(var prop in that)that.hasOwnProperty(prop)&&(this[prop]=that[prop])};IDataResolve.prototype={is:IData.prototype.is,toString:IData.prototype.toString};var resolveData=new IDataResolve;return cb(resolveData),resolveData}),new IData};function UACHData(uach,isHttpUACH){if(uach=uach||{},setProps.call(this,CH_ALL_VALUES),isHttpUACH)setProps.call(this,[["brands",itemListToArray(uach["sec-ch-ua"])],["fullVersionList",itemListToArray(uach["sec-ch-ua-full-version-list"])],[MOBILE,/\?1/.test(uach["sec-ch-ua-mobile"])],[MODEL,stripQuotes(uach["sec-ch-ua-model"])],["platform",stripQuotes(uach["sec-ch-ua-platform"])],["platformVersion",stripQuotes(uach["sec-ch-ua-platform-version"])],["architecture",stripQuotes(uach["sec-ch-ua-arch"])],["formFactors",itemListToArray(uach["sec-ch-ua-form-factors"])],["bitness",stripQuotes(uach["sec-ch-ua-bitness"])]]);else for(var prop in uach)this.hasOwnProperty(prop)&&void 0!==uach[prop]&&(this[prop]=uach[prop])}function UAItem(itemType,ua,rgxMap,uaCH){return this.get=function(prop){return prop?this.data.hasOwnProperty(prop)?this.data[prop]:void 0:this.data},this.set=function(prop,val){return this.data[prop]=val,this},this.setCH=function(ch){return this.uaCH=ch,this},this.detectFeature=function(){if(NAVIGATOR&&NAVIGATOR.userAgent==this.ua)switch(this.itemType){case"browser":NAVIGATOR.brave&&"function"==typeof NAVIGATOR.brave.isBrave&&this.set(NAME,"Brave");break;case"device":!this.get(TYPE)&&NAVIGATOR_UADATA&&NAVIGATOR_UADATA[MOBILE]&&this.set(TYPE,MOBILE),"Macintosh"==this.get(MODEL)&&NAVIGATOR&&void 0!==NAVIGATOR.standalone&&NAVIGATOR.maxTouchPoints&&NAVIGATOR.maxTouchPoints>2&&this.set(MODEL,"iPad").set(TYPE,TABLET);break;case"os":!this.get(NAME)&&NAVIGATOR_UADATA&&NAVIGATOR_UADATA.platform&&this.set(NAME,NAVIGATOR_UADATA.platform);break;case"result":var data=this.data,detect=function(itemType){return data[itemType].getItem().detectFeature().get()};this.set("browser",detect("browser")).set("cpu",detect("cpu")).set("device",detect("device")).set("engine",detect("engine")).set("os",detect("os"))}return this},this.parseUA=function(){return"result"!=this.itemType&&rgxMapper.call(this.data,this.ua,this.rgxMap),"browser"==this.itemType&&this.set("major",majorize(this.get(VERSION))),this},this.parseCH=function(){var uaCH=this.uaCH,rgxMap=this.rgxMap;switch(this.itemType){case"browser":case"engine":var prevName,brands=uaCH.fullVersionList||uaCH.brands;if(brands)for(var i in brands){var brandName=brands[i].brand||brands[i],brandVersion=brands[i].version;"browser"!=this.itemType||/not.a.brand/i.test(brandName)||prevName&&(!/chrom/i.test(prevName)||"Chromium"==brandName)||(brandName=strMapper(brandName,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(NAME,brandName).set(VERSION,brandVersion).set("major",majorize(brandVersion)),prevName=brandName),"engine"==this.itemType&&"Chromium"==brandName&&this.set(VERSION,brandVersion)}break;case"cpu":var archName=uaCH.architecture;archName&&(archName&&"64"==uaCH.bitness&&(archName+="64"),rgxMapper.call(this.data,archName+";",rgxMap));break;case"device":if(uaCH[MOBILE]&&this.set(TYPE,MOBILE),uaCH[MODEL]&&(this.set(MODEL,uaCH[MODEL]),!this.get(TYPE)||!this.get(VENDOR))){var reParse={};rgxMapper.call(reParse,"droid 9; "+uaCH[MODEL]+")",rgxMap),!this.get(TYPE)&&reParse.type&&this.set(TYPE,reParse.type),!this.get(VENDOR)&&reParse.vendor&&this.set(VENDOR,reParse.vendor)}if(uaCH.formFactors){var ff;if("string"!=typeof uaCH.formFactors)for(var idx=0;!ff&&idx<uaCH.formFactors.length;)ff=strMapper(uaCH.formFactors[idx++],formFactorsMap);else ff=strMapper(uaCH.formFactors,formFactorsMap);this.set(TYPE,ff)}break;case"os":var osName=uaCH.platform;if(osName){var osVersion=uaCH.platformVersion;"Windows"==osName&&(osVersion=parseInt(majorize(osVersion),10)>=13?"11":"10"),this.set(NAME,osName).set(VERSION,osVersion)}"Windows"==this.get(NAME)&&"Xbox"==uaCH[MODEL]&&this.set(NAME,"Xbox").set(VERSION,void 0);break;case"result":var data=this.data,parse=function(itemType){return data[itemType].getItem().setCH(uaCH).parseCH().get()};this.set("browser",parse("browser")).set("cpu",parse("cpu")).set("device",parse("device")).set("engine",parse("engine")).set("os",parse("os"))}return this},setProps.call(this,[["itemType",itemType],["ua",ua],["uaCH",uaCH],["rgxMap",rgxMap],["data",createIData(this,itemType)]]),this}function UAParser(ua,extensions,headers){if("object"==typeof ua?(isExtensions(ua,!0)?("object"==typeof extensions&&(headers=extensions),extensions=ua):(headers=ua,extensions=void 0),ua=void 0):"string"!=typeof ua||isExtensions(extensions,!0)||(headers=extensions,extensions=void 0),headers&&"function"==typeof headers.append){var kv={};headers.forEach((function(v,k){kv[k]=v})),headers=kv}if(!(this instanceof UAParser))return new UAParser(ua,extensions,headers).getResult();var userAgent="string"==typeof ua?ua:headers&&headers["user-agent"]?headers["user-agent"]:NAVIGATOR&&NAVIGATOR.userAgent?NAVIGATOR.userAgent:"",httpUACH=new UACHData(headers,!0),regexMap=extensions?function(defaultRgx,extensions){var mergedRgx={},extraRgx=extensions;if(!isExtensions(extensions))for(var i in extraRgx={},extensions)for(var j in extensions[i])extraRgx[j]=extensions[i][j].concat(extraRgx[j]?extraRgx[j]:[]);for(var k in defaultRgx)mergedRgx[k]=extraRgx[k]&&extraRgx[k].length%2==0?extraRgx[k].concat(defaultRgx[k]):defaultRgx[k];return mergedRgx}(defaultRegexes,extensions):defaultRegexes,createItemFunc=function(itemType){return"result"==itemType?function(){return new UAItem(itemType,userAgent,regexMap,httpUACH).set("ua",userAgent).set("browser",this.getBrowser()).set("cpu",this.getCPU()).set("device",this.getDevice()).set("engine",this.getEngine()).set("os",this.getOS()).get()}:function(){return new UAItem(itemType,userAgent,regexMap[itemType],httpUACH).parseUA().get()}};return setProps.call(this,[["getBrowser",createItemFunc("browser")],["getCPU",createItemFunc("cpu")],["getDevice",createItemFunc("device")],["getEngine",createItemFunc("engine")],["getOS",createItemFunc("os")],["getResult",createItemFunc("result")],["getUA",function(){return userAgent}],["setUA",function(ua){return isString(ua)&&(userAgent=ua.length>500?trim(ua,500):ua),this}]]).setUA(userAgent),this}function readLogItemField(tag,obj,pbf){1===tag?obj.time=pbf.readVarint(!0):2===tag?obj.level=pbf.readString():3===tag?obj.content=pbf.readString():4===tag?obj.clientUuid=pbf.readString():5===tag?obj.userAgent=pbf.readString():6===tag?obj.screen=pbf.readString():7===tag?obj.window=pbf.readString():8===tag?obj.url=pbf.readString():9===tag?obj.ip=pbf.readString():10===tag?obj.region=pbf.readString():11===tag&&(obj.referrer=pbf.readString())}UAParser.VERSION="2.0.3",UAParser.BROWSER=enumerize([NAME,VERSION,"major",TYPE]),UAParser.CPU=enumerize(["architecture"]),UAParser.DEVICE=enumerize([MODEL,VENDOR,TYPE,"console",MOBILE,SMARTTV,TABLET,"wearable","embedded"]),UAParser.ENGINE=UAParser.OS=enumerize([NAME,VERSION]);const META_KEYS_USER_AGENT="d1a7b01b334e95fcda7fcdfb8db01454c05cc42a7227e6fb9ef0a9e77a39f12c",META_KEYS_IP="bb9af5d1915da1fbc132ced081325efcd2e63e4804f96890f42e9739677237a4",META_KEYS_REGION="c697d2981bf416569a16cfbcdec1542b5398f3cc77d2b905819aa99c46ecf6f6",META_KEYS_LAST_UPDATE_TIME="0682cd61a299947aa5324230d6d64eb1eef0a9b612cbdd2c7ca25355fb614201";class LogProcessor extends LogStore{constructor(options={}){super(options),this._logDigestCache=null,this._dedupInterval=options.dedupInterval||2e3,this._userAgent=null,this._currentIp=null,this._currentRegion=null,this._lastUpdateTime=0}async _getDigest(str){const data=(new TextEncoder).encode(str),hashBuffer=await crypto.subtle.digest("SHA-256",data);return Array.from(new Uint8Array(hashBuffer)).map((b=>b.toString(16).padStart(2,"0"))).join("")}async _getLogDigestCache(){return this._logDigestCache?this._logDigestCache:(this._logDigestCache=await this.getAllDigests(),this._logDigestCache&&0!==this._logDigestCache.length?(this._logDigestCache=new Map(this._logDigestCache.map((item=>[item.digest,item.timestamp]))),this._logDigestCache):(this._logDigestCache=new Map,this._logDigestCache))}async _addLogDigestCache(digest,timestamp){this._logDigestCache.set(digest,timestamp),await this.setDigest(digest,timestamp)}async _clearLogDigestCache(){this._logDigestCache.clear(),await this.clearOldDigests(Date.now())}async _getMeta(ua){if(this._userAgent&&this._currentIp&&this._currentRegion)return{ua:this._userAgent,ip:this._currentIp,region:this._currentRegion,lastUpdateTime:this._lastUpdateTime};const meta=await this.getAllMeta();this._lastUpdateTime=meta[META_KEYS_LAST_UPDATE_TIME];const now=Date.now();if(this._lastUpdateTime&&function(ts1,ts2){const d1=new Date(Number(ts1)),d2=new Date(Number(ts2));return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()===d2.getMonth()&&d1.getDate()===d2.getDate()}(this._lastUpdateTime,now))return this._userAgent=meta[META_KEYS_USER_AGENT],this._currentIp=meta[META_KEYS_IP],this._currentRegion=meta[META_KEYS_REGION],{ua:this._userAgent,ip:this._currentIp,region:this._currentRegion,lastUpdateTime:this._lastUpdateTime};const{ip:ip,region:region}=await async function(){try{const res=await fetch("https://get.geojs.io/v1/ip/geo.json");if(!res.ok)return{};const data=await res.json();return{ip:data.ip,region:data.country}}catch(e){return{}}}();return this._currentIp=ip,this._currentRegion=region,this._userAgent=JSON.stringify(serializeSingleValue(UAParser(ua))),this._lastUpdateTime=now,await this.setMeta(META_KEYS_LAST_UPDATE_TIME,now),await this.setMeta(META_KEYS_USER_AGENT,this._userAgent),await this.setMeta(META_KEYS_IP,this._currentIp),await this.setMeta(META_KEYS_REGION,this._currentRegion),{ua:this._userAgent,ip:this._currentIp,region:this._currentRegion,lastUpdateTime:this._lastUpdateTime}}async insertLog(logItem){if(!logItem.content)return null;let log=await this.dedupLog(logItem);if(!log)return null;log=await this.completeLog(log);const data=this.encodeLog(log);return await super.insertLog(data),{log:log,size:data.length}}async dedupLog(logItem){const digest=await this._getDigest(logItem.content),lastTime=(await this._getLogDigestCache()).get(digest);return lastTime&&logItem.time-lastTime<=this._dedupInterval?null:(await this._addLogDigestCache(digest,logItem.time),logItem)}async completeLog(logItem){const{ua:ua,ip:ip,region:region}=await this._getMeta(logItem.userAgent);return logItem.userAgent=ua,logItem.ip=ip,logItem.region=region,logItem}encodeLog(logItem){const pbf=new Pbf;return function(obj,pbf){obj.time&&pbf.writeVarintField(1,obj.time),obj.level&&pbf.writeStringField(2,obj.level),obj.content&&pbf.writeStringField(3,obj.content),obj.clientUuid&&pbf.writeStringField(4,obj.clientUuid),obj.userAgent&&pbf.writeStringField(5,obj.userAgent),obj.screen&&pbf.writeStringField(6,obj.screen),obj.window&&pbf.writeStringField(7,obj.window),obj.url&&pbf.writeStringField(8,obj.url),obj.ip&&pbf.writeStringField(9,obj.ip),obj.region&&pbf.writeStringField(10,obj.region),obj.referrer&&pbf.writeStringField(11,obj.referrer)}(logItem,pbf),pbf.finish()}decodeLog(log){return function(pbf,end){return pbf.readFields(readLogItemField,{time:0,level:"",content:"",clientUuid:"",userAgent:"",screen:"",window:"",url:"",ip:"",region:"",referrer:""},end)}(new Pbf(log))}}var u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(eb,start){for(var b=new u16(31),i=0;i<31;++i)b[i]=start+=1<<eb[i-1];var r=new i32(b[30]);for(i=1;i<30;++i)for(var j=b[i];j<b[i+1];++j)r[j]=j-b[i]<<5|i;return{b:b,r:r}},_a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;for(var revfd=freb(fdeb,0).r,rev=new u16(32768),i=0;i<32768;++i){var x=(43690&i)>>1|(21845&i)<<1;x=(61680&(x=(52428&x)>>2|(13107&x)<<2))>>4|(3855&x)<<4,rev[i]=((65280&x)>>8|(255&x)<<8)>>1}var hMap=function(cd,mb,r){for(var s=cd.length,i=0,l=new u16(mb);i<s;++i)cd[i]&&++l[cd[i]-1];var co,le=new u16(mb);for(i=1;i<mb;++i)le[i]=le[i-1]+l[i-1]<<1;if(r){co=new u16(1<<mb);var rvb=15-mb;for(i=0;i<s;++i)if(cd[i])for(var sv=i<<4|cd[i],r_1=mb-cd[i],v=le[cd[i]-1]++<<r_1,m=v|(1<<r_1)-1;v<=m;++v)co[rev[v]>>rvb]=sv}else for(co=new u16(s),i=0;i<s;++i)cd[i]&&(co[i]=rev[le[cd[i]-1]++]>>15-cd[i]);return co},flt=new u8(288);for(i=0;i<144;++i)flt[i]=8;for(i=144;i<256;++i)flt[i]=9;for(i=256;i<280;++i)flt[i]=7;for(i=280;i<288;++i)flt[i]=8;var fdt=new u8(32);for(i=0;i<32;++i)fdt[i]=5;var flm=hMap(flt,9,0),fdm=hMap(fdt,5,0),shft=function(p){return(p+7)/8|0},wbits=function(d,p,v){v<<=7&p;var o=p/8|0;d[o]|=v,d[o+1]|=v>>8},wbits16=function(d,p,v){v<<=7&p;var o=p/8|0;d[o]|=v,d[o+1]|=v>>8,d[o+2]|=v>>16},hTree=function(d,mb){for(var t=[],i=0;i<d.length;++i)d[i]&&t.push({s:i,f:d[i]});var s=t.length,t2=t.slice();if(!s)return{t:et,l:0};if(1==s){var v=new u8(t[0].s+1);return v[t[0].s]=1,{t:v,l:1}}t.sort((function(a,b){return a.f-b.f})),t.push({s:-1,f:25001});var l=t[0],r=t[1],i0=0,i1=1,i2=2;for(t[0]={s:-1,f:l.f+r.f,l:l,r:r};i1!=s-1;)l=t[t[i0].f<t[i2].f?i0++:i2++],r=t[i0!=i1&&t[i0].f<t[i2].f?i0++:i2++],t[i1++]={s:-1,f:l.f+r.f,l:l,r:r};var maxSym=t2[0].s;for(i=1;i<s;++i)t2[i].s>maxSym&&(maxSym=t2[i].s);var tr=new u16(maxSym+1),mbt=ln(t[i1-1],tr,0);if(mbt>mb){i=0;var dt=0,lft=mbt-mb,cst=1<<lft;for(t2.sort((function(a,b){return tr[b.s]-tr[a.s]||a.f-b.f}));i<s;++i){var i2_1=t2[i].s;if(!(tr[i2_1]>mb))break;dt+=cst-(1<<mbt-tr[i2_1]),tr[i2_1]=mb}for(dt>>=lft;dt>0;){var i2_2=t2[i].s;tr[i2_2]<mb?dt-=1<<mb-tr[i2_2]++-1:++i}for(;i>=0&&dt;--i){var i2_3=t2[i].s;tr[i2_3]==mb&&(--tr[i2_3],++dt)}mbt=mb}return{t:new u8(tr),l:mbt}},ln=function(n,l,d){return-1==n.s?Math.max(ln(n.l,l,d+1),ln(n.r,l,d+1)):l[n.s]=d},lc=function(c){for(var s=c.length;s&&!c[--s];);for(var cl=new u16(++s),cli=0,cln=c[0],cls=1,w=function(v){cl[cli++]=v},i=1;i<=s;++i)if(c[i]==cln&&i!=s)++cls;else{if(!cln&&cls>2){for(;cls>138;cls-=138)w(32754);cls>2&&(w(cls>10?cls-11<<5|28690:cls-3<<5|12305),cls=0)}else if(cls>3){for(w(cln),--cls;cls>6;cls-=6)w(8304);cls>2&&(w(cls-3<<5|8208),cls=0)}for(;cls--;)w(cln);cls=1,cln=c[i]}return{c:cl.subarray(0,cli),n:s}},clen=function(cf,cl){for(var l=0,i=0;i<cl.length;++i)l+=cf[i]*cl[i];return l},wfblk=function(out,pos,dat){var s=dat.length,o=shft(pos+2);out[o]=255&s,out[o+1]=s>>8,out[o+2]=255^out[o],out[o+3]=255^out[o+1];for(var i=0;i<s;++i)out[o+i+4]=dat[i];return 8*(o+4+s)},wblk=function(dat,out,final,syms,lf,df,eb,li,bs,bl,p){wbits(out,p++,final),++lf[256];for(var _a=hTree(lf,15),dlt=_a.t,mlb=_a.l,_b=hTree(df,15),ddt=_b.t,mdb=_b.l,_c=lc(dlt),lclt=_c.c,nlc=_c.n,_d=lc(ddt),lcdt=_d.c,ndc=_d.n,lcfreq=new u16(19),i=0;i<lclt.length;++i)++lcfreq[31&lclt[i]];for(i=0;i<lcdt.length;++i)++lcfreq[31&lcdt[i]];for(var _e=hTree(lcfreq,7),lct=_e.t,mlcb=_e.l,nlcc=19;nlcc>4&&!lct[clim[nlcc-1]];--nlcc);var lm,ll,dm,dl,flen=bl+5<<3,ftlen=clen(lf,flt)+clen(df,fdt)+eb,dtlen=clen(lf,dlt)+clen(df,ddt)+eb+14+3*nlcc+clen(lcfreq,lct)+2*lcfreq[16]+3*lcfreq[17]+7*lcfreq[18];if(bs>=0&&flen<=ftlen&&flen<=dtlen)return wfblk(out,p,dat.subarray(bs,bs+bl));if(wbits(out,p,1+(dtlen<ftlen)),p+=2,dtlen<ftlen){lm=hMap(dlt,mlb,0),ll=dlt,dm=hMap(ddt,mdb,0),dl=ddt;var llm=hMap(lct,mlcb,0);wbits(out,p,nlc-257),wbits(out,p+5,ndc-1),wbits(out,p+10,nlcc-4),p+=14;for(i=0;i<nlcc;++i)wbits(out,p+3*i,lct[clim[i]]);p+=3*nlcc;for(var lcts=[lclt,lcdt],it=0;it<2;++it){var clct=lcts[it];for(i=0;i<clct.length;++i){var len=31&clct[i];wbits(out,p,llm[len]),p+=lct[len],len>15&&(wbits(out,p,clct[i]>>5&127),p+=clct[i]>>12)}}}else lm=flm,ll=flt,dm=fdm,dl=fdt;for(i=0;i<li;++i){var sym=syms[i];if(sym>255){wbits16(out,p,lm[(len=sym>>18&31)+257]),p+=ll[len+257],len>7&&(wbits(out,p,sym>>23&31),p+=fleb[len]);var dst=31&sym;wbits16(out,p,dm[dst]),p+=dl[dst],dst>3&&(wbits16(out,p,sym>>5&8191),p+=fdeb[dst])}else wbits16(out,p,lm[sym]),p+=ll[sym]}return wbits16(out,p,lm[256]),p+ll[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et=new u8(0),dflt=function(dat,lvl,plvl,pre,post,st){var s=st.z||dat.length,o=new u8(pre+s+5*(1+Math.ceil(s/7e3))+post),w=o.subarray(pre,o.length-post),lst=st.l,pos=7&(st.r||0);if(lvl){pos&&(w[0]=st.r>>3);for(var opt=deo[lvl-1],n=opt>>13,c=8191&opt,msk_1=(1<<plvl)-1,prev=st.p||new u16(32768),head=st.h||new u16(msk_1+1),bs1_1=Math.ceil(plvl/3),bs2_1=2*bs1_1,hsh=function(i){return(dat[i]^dat[i+1]<<bs1_1^dat[i+2]<<bs2_1)&msk_1},syms=new i32(25e3),lf=new u16(288),df=new u16(32),lc_1=0,eb=0,i=st.i||0,li=0,wi=st.w||0,bs=0;i+2<s;++i){var hv=hsh(i),imod=32767&i,pimod=head[hv];if(prev[imod]=pimod,head[hv]=imod,wi<=i){var rem=s-i;if((lc_1>7e3||li>24576)&&(rem>423||!lst)){pos=wblk(dat,w,0,syms,lf,df,eb,li,bs,i-bs,pos),li=lc_1=eb=0,bs=i;for(var j=0;j<286;++j)lf[j]=0;for(j=0;j<30;++j)df[j]=0}var l=2,d=0,ch_1=c,dif=imod-pimod&32767;if(rem>2&&hv==hsh(i-dif))for(var maxn=Math.min(n,rem)-1,maxd=Math.min(32767,i),ml=Math.min(258,rem);dif<=maxd&&--ch_1&&imod!=pimod;){if(dat[i+l]==dat[i+l-dif]){for(var nl=0;nl<ml&&dat[i+nl]==dat[i+nl-dif];++nl);if(nl>l){if(l=nl,d=dif,nl>maxn)break;var mmd=Math.min(dif,nl-2),md=0;for(j=0;j<mmd;++j){var ti=i-dif+j&32767,cd=ti-prev[ti]&32767;cd>md&&(md=cd,pimod=ti)}}}dif+=(imod=pimod)-(pimod=prev[imod])&32767}if(d){syms[li++]=268435456|revfl[l]<<18|revfd[d];var lin=31&revfl[l],din=31&revfd[d];eb+=fleb[lin]+fdeb[din],++lf[257+lin],++df[din],wi=i+l,++lc_1}else syms[li++]=dat[i],++lf[dat[i]]}}for(i=Math.max(i,wi);i<s;++i)syms[li++]=dat[i],++lf[dat[i]];pos=wblk(dat,w,lst,syms,lf,df,eb,li,bs,i-bs,pos),lst||(st.r=7&pos|w[pos/8|0]<<3,pos-=7,st.h=head,st.p=prev,st.i=i,st.w=wi)}else{for(i=st.w||0;i<s+lst;i+=65535){var e=i+65535;e>=s&&(w[pos/8|0]=lst,e=s),pos=wfblk(w,pos+1,dat.subarray(i,e))}st.i=s}return function(v,s,e){return(null==s||s<0)&&(s=0),(null==e||e>v.length)&&(e=v.length),new u8(v.subarray(s,e))}(o,0,pre+shft(pos)+post)},crct=function(){for(var t=new Int32Array(256),i=0;i<256;++i){for(var c=i,k=9;--k;)c=(1&c&&-306674912)^c>>>1;t[i]=c}return t}(),wbytes=function(d,b,v){for(;v;++b)d[b]=v,v>>>=8};function gzipSync(data,opts){opts||(opts={});var c=function(){var c=-1;return{p:function(d){for(var cr=c,i=0;i<d.length;++i)cr=crct[255&cr^d[i]]^cr>>>8;c=cr},d:function(){return~c}}}(),l=data.length;c.p(data);var o,d=function(dat,opt,pre,post,st){if(!st&&(st={l:1},opt.dictionary)){var dict=opt.dictionary.subarray(-32768),newDat=new u8(dict.length+dat.length);newDat.set(dict),newDat.set(dat,dict.length),dat=newDat,st.w=dict.length}return dflt(dat,null==opt.level?6:opt.level,null==opt.mem?st.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(dat.length)))):20:12+opt.mem,pre,post,st)}(data,opts,10+((o=opts).filename?o.filename.length+1:0),8),s=d.length;return function(c,o){var fn=o.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=o.level<2?4:9==o.level?2:0,c[9]=3,0!=o.mtime&&wbytes(c,4,Math.floor(new Date(o.mtime||Date.now())/1e3)),fn){c[3]=8;for(var i=0;i<=fn.length;++i)c[i+10]=fn.charCodeAt(i)}}(d,opts),wbytes(d,s-8,c.d()),wbytes(d,s-4,l),d}var td="undefined"!=typeof TextDecoder&&new TextDecoder;try{td.decode(et,{stream:!0})}catch(e){}(logEncoder=>{function initSWBridge(){if("undefined"!=typeof window&&"serviceWorker"in navigator){const logProcessor=new LogProcessor,sendSWEvent=async event=>{const serviceWorker=await getServiceWorker("/beacon/");serviceWorker&&serviceWorker.postMessage(event)};window.addEventListener("load",(function(){const loadLog={level:"trace",content:"[logbeacon] page load",...getLogExtraInfo()};navigator.serviceWorker.register("/beacon/beacon-sw.js",{type:"module",scope:"/beacon/"}).finally((()=>{sendEvent({type:"log",payload:loadLog}),sendLog("trace",["[logbeacon] Service Worker registered successfully"]),sendSWEvent({type:"page-load"})})),window.addEventListener("beforeunload",(async function(){const payload={level:"trace",content:"[logbeacon] page unload",...getLogExtraInfo()},data=await logEncoder([payload]);if(data)return;const compressedData=gzipSync(data);compressedData&&compressedData.length>0&&navigator.sendBeacon("/api/beacon",compressedData)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?(sendLog("trace",["[logbeacon] page hidden"]),sendSWEvent({type:"page-hidden"})):"visible"===document.visibilityState&&(sendLog("trace",["[logbeacon] page visible"]),sendSWEvent({type:"page-visible"}))})),window.addEventListener("error",(function(e){sendLog("error",[e])})),window.addEventListener("unhandledrejection",(function(e){sendLog("error",[e])})),window.addEventListener("sendLog",(function(e){"log"===e.detail.type&&logProcessor.insertLog(e.detail.payload)}))}))}}"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",initSWBridge):initSWBridge())})(logEncoder);
